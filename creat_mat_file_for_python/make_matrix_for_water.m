function [first, second,third,fourth]=make_matrix_for_water(lpfile,scenario, num2stage,num3stage,num4stage,seed, savefile)

gpcd_scen = 1;
population_scen = 'wisp';


rng(seed)
load(lpfile)
num_var = 100;num_row = 60;
StagePeriods=[3,9,10,15];


%% data lp
tmp.c=lp.Getq(scenario);
tmp.A=lp.GetD(scenario);
tmp.B=lp.GetB(scenario);
tmp.b=lp.Getd(scenario);
tmp.l=lp.Getl2(scenario);
tmp.u=lp.Getu2(scenario);


%% First
first.StagePeriods=StagePeriods(1);
first.obj=lp.c;
first.A=lp.A;
first.rhs=lp.b;
first.lb=lp.l;
first.ub=lp.u;
first.obs = ones(1,num2stage);
first.numScenarios = num2stage;


%% Second_tmp
second_tmp.StagePeriods=StagePeriods(2);
second_tmp.obj=tmp.c(1:num_var*sum(StagePeriods(2:2)));
second_tmp.A=tmp.A(1:num_row*sum(StagePeriods(2:2)),1:num_var*sum(StagePeriods(2:2)));
second_tmp.B=tmp.B(1:num_row*sum(StagePeriods(2:2)),1:num_var*sum(StagePeriods(1:1)));
second_tmp.rhs=tmp.b(1:num_row*sum(StagePeriods(2:2)));
second_tmp.lb=tmp.l(1:num_var*sum(StagePeriods(2:2)));
second_tmp.ub=tmp.u(1:num_var*sum(StagePeriods(2:2)));
second_tmp.obs = ones(1,num3stage);
second_tmp.numScenarios = num3stage;

%% Third_tmp
third_tmp.StagePeriods=StagePeriods(3);
third_tmp.obj=tmp.c(num_var*sum(StagePeriods(2:2))+1:num_var*sum(StagePeriods(2:3)));
third_tmp.A=tmp.A(num_row*sum(StagePeriods(2:2))+1:num_row*sum(StagePeriods(2:3)),num_var*sum(StagePeriods(2:2))+1:num_var*sum(StagePeriods(2:3)));
third_tmp.B=-tmp.A(num_row*sum(StagePeriods(2:2))+1:num_row*sum(StagePeriods(2:3)),1:num_var*sum(StagePeriods(2:2)));
third_tmp.rhs=tmp.b(num_row*sum(StagePeriods(2:2))+1:num_row*sum(StagePeriods(2:3)));
third_tmp.lb=tmp.l(num_var*sum(StagePeriods(2:2))+1:num_var*sum(StagePeriods(2:3)));
third_tmp.ub=tmp.u(num_var*sum(StagePeriods(2:2))+1:num_var*sum(StagePeriods(2:3)));
third_tmp.obs = ones(1,num4stage);
third_tmp.numScenarios = num4stage;



%% Fourth_tmp
fourth_tmp.StagePeriods=StagePeriods(4);
fourth_tmp.obj=tmp.c(num_var*sum(StagePeriods(2:3))+1:num_var*sum(StagePeriods(2:4)));
fourth_tmp.A=tmp.A(num_row*sum(StagePeriods(2:3))+1:num_row*sum(StagePeriods(2:4)),num_var*sum(StagePeriods(2:3))+1:num_var*sum(StagePeriods(2:4)));
fourth_tmp.B=-tmp.A(num_row*sum(StagePeriods(2:3))+1:num_row*sum(StagePeriods(2:4)),num_var*sum(StagePeriods(2:2))+1:num_var*sum(StagePeriods(2:3)));
fourth_tmp.rhs=tmp.b(num_row*sum(StagePeriods(2:3))+1:num_row*sum(StagePeriods(2:4)));
fourth_tmp.lb=tmp.l(num_var*sum(StagePeriods(2:3))+1:num_var*sum(StagePeriods(2:4)));
fourth_tmp.ub=tmp.u(num_var*sum(StagePeriods(2:3))+1:num_var*sum(StagePeriods(2:4)));


%% convert to row vector
first.obj=first.obj(:)';second_tmp.obj=second_tmp.obj(:)';third_tmp.obj=third_tmp.obj(:)';fourth_tmp.obj=fourth_tmp.obj(:)';
first.rhs=first.rhs(:)';second_tmp.rhs=second_tmp.rhs(:)';third_tmp.rhs=third_tmp.rhs(:)';fourth_tmp.rhs=fourth_tmp.rhs(:)';
first.lb=first.lb(:)';second_tmp.lb=second_tmp.lb(:)';third_tmp.lb=third_tmp.lb(:)';fourth_tmp.lb=fourth_tmp.lb(:)';
first.ub=first.ub(:)';second_tmp.ub=second_tmp.ub(:)';third_tmp.ub=third_tmp.ub(:)';fourth_tmp.ub=fourth_tmp.ub(:)';




%% GPCD Data (2014~2050)
%% Population Data (2014~2050)
switch lower(population_scen)
    case 'wisp'
        pop_scen=[5688,5688,7707.80000000000,9727.60000000000,11747.4000000000,13767.2000000000,15787,16627.6000000000,17468.2000000000,18308.8000000000,19149.4000000000,19990,20790,21590,22390,23190,23990,23990,23990,23990,23990,23990,23990,23990,23990,23990,23990,23990,23990,23990,23990,23990,23990,23990,23990,23990,23990;5688,5688,7707.80000000000,9727.60000000000,11747.4000000000,13767.2000000000,15787,16627.6000000000,17468.2000000000,18308.8000000000,19149.4000000000,19990,20790,21590,22390,23190,23990,23990,23990,23990,23990,23990,23990,23990,23990,23990,23990,23990,23990,23990,23990,23990,23990,23990,23990,23990,23990;4437.80000000000,4602,6490.40000000000,8378.80000000000,10267.2000000000,12155.6000000000,14044,20644.2000000000,27244.4000000000,33844.6000000000,40444.8000000000,47045,52354.6000000000,57664.2000000000,62973.8000000000,68283.4000000000,73593,79394,85195,90996,96797,102598,106322.400000000,110046.800000000,113771.200000000,117495.600000000,121220,124711.800000000,128203.600000000,131695.400000000,135187.200000000,138679,140875,143071,145267,147463,149659;4437.80000000000,4602,6490.40000000000,8378.80000000000,10267.2000000000,12155.6000000000,14044,20644.2000000000,27244.4000000000,33844.6000000000,40444.8000000000,47045,52354.6000000000,57664.2000000000,62973.8000000000,68283.4000000000,73593,79394,85195,90996,96797,102598,106322.400000000,110046.800000000,113771.200000000,117495.600000000,121220,124711.800000000,128203.600000000,131695.400000000,135187.200000000,138679,140875,143071,145267,147463,149659;9387.20000000000,11236,16593.2000000000,21950.4000000000,27307.6000000000,32664.8000000000,38022,42652.2000000000,47282.4000000000,51912.6000000000,56542.8000000000,61173,67440.6000000000,73708.2000000000,79975.8000000000,86243.4000000000,92511,102762,113013,123264,133515,143766,147123.800000000,150481.600000000,153839.400000000,157197.200000000,160555,163487.200000000,166419.400000000,169351.600000000,172283.800000000,175216,176715.800000000,178215.600000000,179715.400000000,181215.200000000,182715;9387.20000000000,11236,16593.2000000000,21950.4000000000,27307.6000000000,32664.8000000000,38022,42652.2000000000,47282.4000000000,51912.6000000000,56542.8000000000,61173,67440.6000000000,73708.2000000000,79975.8000000000,86243.4000000000,92511,102762,113013,123264,133515,143766,147123.800000000,150481.600000000,153839.400000000,157197.200000000,160555,163487.200000000,166419.400000000,169351.600000000,172283.800000000,175216,176715.800000000,178215.600000000,179715.400000000,181215.200000000,182715;5137.30000000000,5916.50000000000,7425.30000000000,8934.10000000000,10442.9000000000,11951.7000000000,13460.5000000000,14258.3000000000,15056.1000000000,15853.9000000000,16651.7000000000,17449.5000000000,18310.2000000000,19170.9000000000,20031.6000000000,20892.3000000000,21753,22012.2000000000,22271.4000000000,22530.6000000000,22789.8000000000,23049,25438.2000000000,27827.4000000000,30216.6000000000,32605.8000000000,34995,39343.6000000000,43692.2000000000,48040.8000000000,52389.4000000000,56738,59874,63010,66146,69282,72418;5137.30000000000,5916.50000000000,7425.30000000000,8934.10000000000,10442.9000000000,11951.7000000000,13460.5000000000,14258.3000000000,15056.1000000000,15853.9000000000,16651.7000000000,17449.5000000000,18310.2000000000,19170.9000000000,20031.6000000000,20892.3000000000,21753,22012.2000000000,22271.4000000000,22530.6000000000,22789.8000000000,23049,25438.2000000000,27827.4000000000,30216.6000000000,32605.8000000000,34995,39343.6000000000,43692.2000000000,48040.8000000000,52389.4000000000,56738,59874,63010,66146,69282,72418;11449,13379,14343.9000000000,15308.8000000000,16273.7000000000,17238.6000000000,18203.5000000000,18277.2000000000,18350.9000000000,18424.6000000000,18498.3000000000,18572,18846.6000000000,19121.2000000000,19395.8000000000,19670.4000000000,19945,20190.6000000000,20436.2000000000,20681.8000000000,20927.4000000000,21173,22417.3000000000,23661.6000000000,24905.9000000000,26150.2000000000,27394.5000000000,27394.5000000000,27394.5000000000,27394.5000000000,27394.5000000000,27394.5000000000,29630.2000000000,31865.9000000000,34101.6000000000,36337.3000000000,38573;11449,13379,14343.9000000000,15308.8000000000,16273.7000000000,17238.6000000000,18203.5000000000,18277.2000000000,18350.9000000000,18424.6000000000,18498.3000000000,18572,18846.6000000000,19121.2000000000,19395.8000000000,19670.4000000000,19945,20190.6000000000,20436.2000000000,20681.8000000000,20927.4000000000,21173,22417.3000000000,23661.6000000000,24905.9000000000,26150.2000000000,27394.5000000000,27394.5000000000,27394.5000000000,27394.5000000000,27394.5000000000,27394.5000000000,29630.2000000000,31865.9000000000,34101.6000000000,36337.3000000000,38573;8498.70000000000,10097,10400.8000000000,10704.6000000000,11008.4000000000,11312.2000000000,11616,12121.2000000000,12626.4000000000,13131.6000000000,13636.8000000000,14142,14146.2000000000,14150.4000000000,14154.6000000000,14158.8000000000,14163,14217.6000000000,14272.2000000000,14326.8000000000,14381.4000000000,14436,15127.7000000000,15819.4000000000,16511.1000000000,17202.8000000000,17894.5000000000,18920.9000000000,19947.3000000000,20973.7000000000,22000.1000000000,23026.5000000000,23906.8000000000,24787.1000000000,25667.4000000000,26547.7000000000,27428;8498.70000000000,10097,10400.8000000000,10704.6000000000,11008.4000000000,11312.2000000000,11616,12121.2000000000,12626.4000000000,13131.6000000000,13636.8000000000,14142,14146.2000000000,14150.4000000000,14154.6000000000,14158.8000000000,14163,14217.6000000000,14272.2000000000,14326.8000000000,14381.4000000000,14436,15127.7000000000,15819.4000000000,16511.1000000000,17202.8000000000,17894.5000000000,18920.9000000000,19947.3000000000,20973.7000000000,22000.1000000000,23026.5000000000,23906.8000000000,24787.1000000000,25667.4000000000,26547.7000000000,27428;20446.8000000000,23100,24127.4000000000,25154.8000000000,26182.2000000000,27209.6000000000,28237,30338.6000000000,32440.2000000000,34541.8000000000,36643.4000000000,38745,40562.2000000000,42379.4000000000,44196.6000000000,46013.8000000000,47831,47831,47831,47831,47831,47831,49273,50715,52157,53599,55041,55041,55041,55041,55041,55041,56015.6000000000,56990.2000000000,57964.8000000000,58939.4000000000,59914;20446.8000000000,23100,24127.4000000000,25154.8000000000,26182.2000000000,27209.6000000000,28237,30338.6000000000,32440.2000000000,34541.8000000000,36643.4000000000,38745,40562.2000000000,42379.4000000000,44196.6000000000,46013.8000000000,47831,47831,47831,47831,47831,47831,49273,50715,52157,53599,55041,55041,55041,55041,55041,55041,56015.6000000000,56990.2000000000,57964.8000000000,58939.4000000000,59914;5137.30000000000,5916.50000000000,7425.30000000000,8934.10000000000,10442.9000000000,11951.7000000000,13460.5000000000,14258.3000000000,15056.1000000000,15853.9000000000,16651.7000000000,17449.5000000000,18310.2000000000,19170.9000000000,20031.6000000000,20892.3000000000,21753,22012.2000000000,22271.4000000000,22530.6000000000,22789.8000000000,23049,25438.2000000000,27827.4000000000,30216.6000000000,32605.8000000000,34995,39343.6000000000,43692.2000000000,48040.8000000000,52389.4000000000,56738,59874,63010,66146,69282,72418;5137.30000000000,5916.50000000000,7425.30000000000,8934.10000000000,10442.9000000000,11951.7000000000,13460.5000000000,14258.3000000000,15056.1000000000,15853.9000000000,16651.7000000000,17449.5000000000,18310.2000000000,19170.9000000000,20031.6000000000,20892.3000000000,21753,22012.2000000000,22271.4000000000,22530.6000000000,22789.8000000000,23049,25438.2000000000,27827.4000000000,30216.6000000000,32605.8000000000,34995,39343.6000000000,43692.2000000000,48040.8000000000,52389.4000000000,56738,59874,63010,66146,69282,72418;11449,13379,14343.9000000000,15308.8000000000,16273.7000000000,17238.6000000000,18203.5000000000,18277.2000000000,18350.9000000000,18424.6000000000,18498.3000000000,18572,18846.6000000000,19121.2000000000,19395.8000000000,19670.4000000000,19945,20190.6000000000,20436.2000000000,20681.8000000000,20927.4000000000,21173,22417.3000000000,23661.6000000000,24905.9000000000,26150.2000000000,27394.5000000000,27394.5000000000,27394.5000000000,27394.5000000000,27394.5000000000,27394.5000000000,29630.2000000000,31865.9000000000,34101.6000000000,36337.3000000000,38573;11449,13379,14343.9000000000,15308.8000000000,16273.7000000000,17238.6000000000,18203.5000000000,18277.2000000000,18350.9000000000,18424.6000000000,18498.3000000000,18572,18846.6000000000,19121.2000000000,19395.8000000000,19670.4000000000,19945,20190.6000000000,20436.2000000000,20681.8000000000,20927.4000000000,21173,22417.3000000000,23661.6000000000,24905.9000000000,26150.2000000000,27394.5000000000,27394.5000000000,27394.5000000000,27394.5000000000,27394.5000000000,27394.5000000000,29630.2000000000,31865.9000000000,34101.6000000000,36337.3000000000,38573;8498.70000000000,10097,10400.8000000000,10704.6000000000,11008.4000000000,11312.2000000000,11616,12121.2000000000,12626.4000000000,13131.6000000000,13636.8000000000,14142,14146.2000000000,14150.4000000000,14154.6000000000,14158.8000000000,14163,14217.6000000000,14272.2000000000,14326.8000000000,14381.4000000000,14436,15127.7000000000,15819.4000000000,16511.1000000000,17202.8000000000,17894.5000000000,18920.9000000000,19947.3000000000,20973.7000000000,22000.1000000000,23026.5000000000,23906.8000000000,24787.1000000000,25667.4000000000,26547.7000000000,27428;8498.70000000000,10097,10400.8000000000,10704.6000000000,11008.4000000000,11312.2000000000,11616,12121.2000000000,12626.4000000000,13131.6000000000,13636.8000000000,14142,14146.2000000000,14150.4000000000,14154.6000000000,14158.8000000000,14163,14217.6000000000,14272.2000000000,14326.8000000000,14381.4000000000,14436,15127.7000000000,15819.4000000000,16511.1000000000,17202.8000000000,17894.5000000000,18920.9000000000,19947.3000000000,20973.7000000000,22000.1000000000,23026.5000000000,23906.8000000000,24787.1000000000,25667.4000000000,26547.7000000000,27428];
    case 'taz'
        pop_scen=[5688,5688,5688,5688,5688,5688,5688,7296.20000000000,8904.40000000000,10512.6000000000,12120.8000000000,13729,14140.6000000000,14552.2000000000,14963.8000000000,15375.4000000000,15787,16627.6000000000,17468.2000000000,18308.8000000000,19149.4000000000,19990,20790,21590,22390,23190,23990,23990,23990,23990,23990,23990,23990,23990,23990,23990,23990;5688,5688,5688,5688,5688,5688,5688,7296.20000000000,8904.40000000000,10512.6000000000,12120.8000000000,13729,14140.6000000000,14552.2000000000,14963.8000000000,15375.4000000000,15787,16627.6000000000,17468.2000000000,18308.8000000000,19149.4000000000,19990,20790,21590,22390,23190,23990,23990,23990,23990,23990,23990,23990,23990,23990,23990,23990;4437.80000000000,4602,4699.20000000000,4796.40000000000,4893.60000000000,4990.80000000000,5088,6474.40000000000,7860.80000000000,9247.20000000000,10633.6000000000,12020,16058.8000000000,20097.6000000000,24136.4000000000,28175.2000000000,32214,35180.2000000000,38146.4000000000,41112.6000000000,44078.8000000000,47045,51394.8000000000,55744.6000000000,60094.4000000000,64444.2000000000,68794,70415.2000000000,72036.4000000000,73657.6000000000,75278.8000000000,76900,80991.8000000000,85083.6000000000,89175.4000000000,93267.2000000000,97359;4437.80000000000,4602,4699.20000000000,4796.40000000000,4893.60000000000,4990.80000000000,5088,6474.40000000000,7860.80000000000,9247.20000000000,10633.6000000000,12020,16058.8000000000,20097.6000000000,24136.4000000000,28175.2000000000,32214,35180.2000000000,38146.4000000000,41112.6000000000,44078.8000000000,47045,51394.8000000000,55744.6000000000,60094.4000000000,64444.2000000000,68794,70415.2000000000,72036.4000000000,73657.6000000000,75278.8000000000,76900,80991.8000000000,85083.6000000000,89175.4000000000,93267.2000000000,97359;4784.80000000000,5483,7135.80000000000,8788.60000000000,10441.4000000000,12094.2000000000,13747,17675.8000000000,21604.6000000000,25533.4000000000,29462.2000000000,33391,34317.2000000000,35243.4000000000,36169.6000000000,37095.8000000000,38022,42000.6000000000,45979.2000000000,49957.8000000000,53936.4000000000,57915,61755,65595,69435,73275,77115,81463.2000000000,85811.4000000000,90159.6000000000,94507.8000000000,98856,104408.600000000,109961.200000000,115513.800000000,121066.400000000,126619;4784.80000000000,5483,7135.80000000000,8788.60000000000,10441.4000000000,12094.2000000000,13747,17675.8000000000,21604.6000000000,25533.4000000000,29462.2000000000,33391,34317.2000000000,35243.4000000000,36169.6000000000,37095.8000000000,38022,42000.6000000000,45979.2000000000,49957.8000000000,53936.4000000000,57915,61755,65595,69435,73275,77115,81463.2000000000,85811.4000000000,90159.6000000000,94507.8000000000,98856,104408.600000000,109961.200000000,115513.800000000,121066.400000000,126619;5038.10000000000,5792.50000000000,6304.40000000000,6816.30000000000,7328.20000000000,7840.10000000000,8352,8727.70000000000,9103.40000000000,9479.10000000000,9854.80000000000,10230.5000000000,11674.3000000000,13118.1000000000,14561.9000000000,16005.7000000000,17449.5000000000,17449.5000000000,17449.5000000000,17449.5000000000,17449.5000000000,17449.5000000000,17449.5000000000,17449.5000000000,17449.5000000000,17449.5000000000,17449.5000000000,18550,19650.5000000000,20751,21851.5000000000,22952,22971.4000000000,22990.8000000000,23010.2000000000,23029.6000000000,23049;5038.10000000000,5792.50000000000,6304.40000000000,6816.30000000000,7328.20000000000,7840.10000000000,8352,8727.70000000000,9103.40000000000,9479.10000000000,9854.80000000000,10230.5000000000,11674.3000000000,13118.1000000000,14561.9000000000,16005.7000000000,17449.5000000000,17449.5000000000,17449.5000000000,17449.5000000000,17449.5000000000,17449.5000000000,17449.5000000000,17449.5000000000,17449.5000000000,17449.5000000000,17449.5000000000,18550,19650.5000000000,20751,21851.5000000000,22952,22971.4000000000,22990.8000000000,23010.2000000000,23029.6000000000,23049;8735.40000000000,9987,11350.4000000000,12713.8000000000,14077.2000000000,15440.6000000000,16804,17083,17362,17641,17920,18199,18199.9000000000,18200.8000000000,18201.7000000000,18202.6000000000,18203.5000000000,18277.2000000000,18350.9000000000,18424.6000000000,18498.3000000000,18572,18572,18572,18572,18572,18572,18850.8000000000,19129.6000000000,19408.4000000000,19687.2000000000,19966,20207.4000000000,20448.8000000000,20690.2000000000,20931.6000000000,21173;8735.40000000000,9987,11350.4000000000,12713.8000000000,14077.2000000000,15440.6000000000,16804,17083,17362,17641,17920,18199,18199.9000000000,18200.8000000000,18201.7000000000,18202.6000000000,18203.5000000000,18277.2000000000,18350.9000000000,18424.6000000000,18498.3000000000,18572,18572,18572,18572,18572,18572,18850.8000000000,19129.6000000000,19408.4000000000,19687.2000000000,19966,20207.4000000000,20448.8000000000,20690.2000000000,20931.6000000000,21173;4114.30000000000,4616.50000000000,5811,7005.50000000000,8200,9394.50000000000,10589,10769,10949,11129,11309,11489,11998.2000000000,12507.4000000000,13016.6000000000,13525.8000000000,14035,14056.4000000000,14077.8000000000,14099.2000000000,14120.6000000000,14142,14142,14142,14142,14142,14142,14198.4000000000,14254.8000000000,14311.2000000000,14367.6000000000,14424,14426.4000000000,14428.8000000000,14431.2000000000,14433.6000000000,14436;4114.30000000000,4616.50000000000,5811,7005.50000000000,8200,9394.50000000000,10589,10769,10949,11129,11309,11489,11998.2000000000,12507.4000000000,13016.6000000000,13525.8000000000,14035,14056.4000000000,14077.8000000000,14099.2000000000,14120.6000000000,14142,14142,14142,14142,14142,14142,14198.4000000000,14254.8000000000,14311.2000000000,14367.6000000000,14424,14426.4000000000,14428.8000000000,14431.2000000000,14433.6000000000,14436;16863.6000000000,18621,19516.8000000000,20412.6000000000,21308.4000000000,22204.2000000000,23100,23838.8000000000,24577.6000000000,25316.4000000000,26055.2000000000,26794,27208.6000000000,27623.2000000000,28037.8000000000,28452.4000000000,28867,30842.6000000000,32818.2000000000,34793.8000000000,36769.4000000000,38745,39228.8000000000,39712.6000000000,40196.4000000000,40680.2000000000,41164,42497.4000000000,43830.8000000000,45164.2000000000,46497.6000000000,47831,47831,47831,47831,47831,47831;16863.6000000000,18621,19516.8000000000,20412.6000000000,21308.4000000000,22204.2000000000,23100,23838.8000000000,24577.6000000000,25316.4000000000,26055.2000000000,26794,27208.6000000000,27623.2000000000,28037.8000000000,28452.4000000000,28867,30842.6000000000,32818.2000000000,34793.8000000000,36769.4000000000,38745,39228.8000000000,39712.6000000000,40196.4000000000,40680.2000000000,41164,42497.4000000000,43830.8000000000,45164.2000000000,46497.6000000000,47831,47831,47831,47831,47831,47831;5038.10000000000,5792.50000000000,6304.40000000000,6816.30000000000,7328.20000000000,7840.10000000000,8352,8727.70000000000,9103.40000000000,9479.10000000000,9854.80000000000,10230.5000000000,11674.3000000000,13118.1000000000,14561.9000000000,16005.7000000000,17449.5000000000,17449.5000000000,17449.5000000000,17449.5000000000,17449.5000000000,17449.5000000000,17449.5000000000,17449.5000000000,17449.5000000000,17449.5000000000,17449.5000000000,18550,19650.5000000000,20751,21851.5000000000,22952,22971.4000000000,22990.8000000000,23010.2000000000,23029.6000000000,23049;5038.10000000000,5792.50000000000,6304.40000000000,6816.30000000000,7328.20000000000,7840.10000000000,8352,8727.70000000000,9103.40000000000,9479.10000000000,9854.80000000000,10230.5000000000,11674.3000000000,13118.1000000000,14561.9000000000,16005.7000000000,17449.5000000000,17449.5000000000,17449.5000000000,17449.5000000000,17449.5000000000,17449.5000000000,17449.5000000000,17449.5000000000,17449.5000000000,17449.5000000000,17449.5000000000,18550,19650.5000000000,20751,21851.5000000000,22952,22971.4000000000,22990.8000000000,23010.2000000000,23029.6000000000,23049;8735.40000000000,9987,11350.4000000000,12713.8000000000,14077.2000000000,15440.6000000000,16804,17083,17362,17641,17920,18199,18199.9000000000,18200.8000000000,18201.7000000000,18202.6000000000,18203.5000000000,18277.2000000000,18350.9000000000,18424.6000000000,18498.3000000000,18572,18572,18572,18572,18572,18572,18850.8000000000,19129.6000000000,19408.4000000000,19687.2000000000,19966,20207.4000000000,20448.8000000000,20690.2000000000,20931.6000000000,21173;8735.40000000000,9987,11350.4000000000,12713.8000000000,14077.2000000000,15440.6000000000,16804,17083,17362,17641,17920,18199,18199.9000000000,18200.8000000000,18201.7000000000,18202.6000000000,18203.5000000000,18277.2000000000,18350.9000000000,18424.6000000000,18498.3000000000,18572,18572,18572,18572,18572,18572,18850.8000000000,19129.6000000000,19408.4000000000,19687.2000000000,19966,20207.4000000000,20448.8000000000,20690.2000000000,20931.6000000000,21173;4114.30000000000,4616.50000000000,5811,7005.50000000000,8200,9394.50000000000,10589,10769,10949,11129,11309,11489,11998.2000000000,12507.4000000000,13016.6000000000,13525.8000000000,14035,14056.4000000000,14077.8000000000,14099.2000000000,14120.6000000000,14142,14142,14142,14142,14142,14142,14198.4000000000,14254.8000000000,14311.2000000000,14367.6000000000,14424,14426.4000000000,14428.8000000000,14431.2000000000,14433.6000000000,14436;4114.30000000000,4616.50000000000,5811,7005.50000000000,8200,9394.50000000000,10589,10769,10949,11129,11309,11489,11998.2000000000,12507.4000000000,13016.6000000000,13525.8000000000,14035,14056.4000000000,14077.8000000000,14099.2000000000,14120.6000000000,14142,14142,14142,14142,14142,14142,14198.4000000000,14254.8000000000,14311.2000000000,14367.6000000000,14424,14426.4000000000,14428.8000000000,14431.2000000000,14433.6000000000,14436];
    otherwise
        error('Population Scenario:population_scen: Unknown ')
end
time_series_index = [17;18;22;23;27;28;32;33;37;38;42;43;45;46;50;51;55;56;58;59];
[gpcd_month,gpcd_scen_name] = xlsread('gpcd_month.xlsx');
gpcd_month = gpcd_month(:,[1:3,3+gpcd_scen]);
gpcd_scen_name = gpcd_scen_name([1:3,3+gpcd_scen]);

% make gpdc scenario
% 1. original gpcd + error  normrnd(0,sqrt(55.27)
% 2. make gpcd_year
% 3. rhs = gpcd_year * gpd2afy * Potatble/NonPotatble * Population(zone) 
Potatble= 0.8;
NonPotatble = 1-Potatble;
PNP = repmat([Potatble;NonPotatble],10,1);
gpd2afy=0.00112;

first.gpcd_month=gpcd_month(1:StagePeriods(1)*12,:);
first.gpcd_year = sum(reshape(first.gpcd_month(:,3).*first.gpcd_month(:,4),12,first.StagePeriods))/365;
first.rhs_tmp = reshape(first.rhs,num_row,first.StagePeriods);
first.rhs_tmp(time_series_index,:) = repmat(first.gpcd_year,20,1)*gpd2afy.*PNP.*pop_scen(:,1:StagePeriods(1));
first.rhs = first.rhs_tmp(:)';
for i=1:num2stage
    second_tmp.gpcd_month{i,1}=gpcd_month(StagePeriods(1)*12+1:sum(StagePeriods(1:2))*12,:) + [zeros(StagePeriods(2)*12,3) normrnd(0,sqrt(55.27),StagePeriods(2)*12,1)];
    second_tmp.gpcd_year{i,1} = sum(reshape(second_tmp.gpcd_month{i,1}(:,3).*second_tmp.gpcd_month{i,1}(:,4),12,second_tmp.StagePeriods))/365;
    second_tmp.rhs_tmp{i,1} = reshape(second_tmp.rhs,num_row,second_tmp.StagePeriods);
    second_tmp.rhs_tmp{i,1}(time_series_index,:) = repmat(second_tmp.gpcd_year{i,1},20,1)*gpd2afy.*PNP.*pop_scen(:,StagePeriods(1)+1:sum(StagePeriods(1:2)));
    second_tmp.rhs_tmp{i,1} = second_tmp.rhs_tmp{i,1}(:)';
    for j=1:num3stage
        third_tmp.gpcd_month{i,j}=gpcd_month(sum(StagePeriods(1:2))*12+1:sum(StagePeriods(1:3))*12,:)+ [zeros(StagePeriods(3)*12,3) normrnd(0,sqrt(55.27),StagePeriods(3)*12,1)];
        third_tmp.gpcd_year{i,j} = sum(reshape(third_tmp.gpcd_month{i,j}(:,3).*third_tmp.gpcd_month{i,j}(:,4),12,third_tmp.StagePeriods))/365;
        third_tmp.rhs_tmp{i,j} = reshape(third_tmp.rhs,num_row,third_tmp.StagePeriods);
        third_tmp.rhs_tmp{i,j}(time_series_index,:) = repmat(third_tmp.gpcd_year{i,j},20,1)*gpd2afy.*PNP.*pop_scen(:,sum(StagePeriods(1:2))+1:sum(StagePeriods(1:3)));
        third_tmp.rhs_tmp{i,j} = third_tmp.rhs_tmp{i,j}(:)';
        for k=1:num4stage
            fourth_tmp.gpcd_month{i,j,k}=gpcd_month(sum(StagePeriods(1:3))*12+1:end,:)+ [zeros(StagePeriods(4)*12,3) normrnd(0,sqrt(55.27),StagePeriods(4)*12,1)];
            fourth_tmp.gpcd_year{i,j,k} = sum(reshape(fourth_tmp.gpcd_month{i,j,k}(:,3).*fourth_tmp.gpcd_month{i,j,k}(:,4),12,fourth_tmp.StagePeriods))/365;
            fourth_tmp.rhs_tmp{i,j,k} = reshape(fourth_tmp.rhs,num_row,fourth_tmp.StagePeriods);
            fourth_tmp.rhs_tmp{i,j,k}(time_series_index,:) = repmat(fourth_tmp.gpcd_year{i,j,k},20,1)*gpd2afy.*PNP.*pop_scen(:,sum(StagePeriods(1:3))+1:sum(StagePeriods(1:4)));
            fourth_tmp.rhs_tmp{i,j,k} = fourth_tmp.rhs_tmp{i,j,k}(:)';
        end
    end
end



display(strcat('Population: ',upper(population_scen),', ','GPCD:' ,gpcd_scen_name{gpcd_scen+3}))





%% Scenario Tree
for i=1:num2stage
    second.StagePeriods{i,1}=second_tmp.StagePeriods;
    second.obj{i,1}=second_tmp.obj;
    second.A{i,1}=second_tmp.A;
    second.B{i,1}=second_tmp.B;
    second.rhs{i,1}=second_tmp.rhs_tmp{i,1};
    second.lb{i,1}=second_tmp.lb;
    second.ub{i,1}=second_tmp.ub;
    second.obs{i,1}=second_tmp.obs;
    second.numScenarios{i,1}=second_tmp.numScenarios;
    for j=1:num3stage
        third.StagePeriods{i,j}=third_tmp.StagePeriods;
        third.obj{i,j}=third_tmp.obj;
        third.A{i,j}=third_tmp.A;
        third.B{i,j}=third_tmp.B;
        third.rhs{i,j}=third_tmp.rhs_tmp{i,j};
        third.lb{i,j}=third_tmp.lb;
        third.ub{i,j}=third_tmp.ub;
        third.obs{i,j}=third_tmp.obs;
        third.numScenarios{i,j}=third_tmp.numScenarios;
        for k=1:num4stage
            fourth.StagePeriods{i,j,k}=fourth_tmp.StagePeriods;
            fourth.obj{i,j,k}=fourth_tmp.obj;
            fourth.A{i,j,k}=fourth_tmp.A;
            fourth.B{i,j,k}=fourth_tmp.B;
            fourth.rhs{i,j,k}=fourth_tmp.rhs_tmp{i,j,k};
            fourth.lb{i,j,k}=fourth_tmp.lb;
            fourth.ub{i,j,k}=fourth_tmp.ub;
        end
    end
end
numStages=4;
save(savefile, 'first', 'second','third','fourth','numStages')





